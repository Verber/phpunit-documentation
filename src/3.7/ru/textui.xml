<?xml version="1.0" encoding="utf-8" ?>

<chapter id="textui">
  <title>Запуск тестов из командной строки</title>

  <para>
    PHPUnit можно вызвать с помощью консольной команды
    <filename>phpunit</filename>. Пример, который показывает запуск PHPUnit из
    командной строки:
  </para>

  <screen><userinput>phpunit ArrayTest</userinput>
PHPUnit 3.7.0 by Sebastian Bergmann.

..

Time: 0 seconds


OK (2 tests, 2 assertions)</screen>

  <para>
    Для каждого теста PHPUnit выводит на экран один символ:
  </para>

  <variablelist>
    <varlistentry>
      <term><literal>.</literal></term>
      <listitem>
        <para>
          Выводится, если тест прошел.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><literal>F</literal></term>
      <listitem>
        <para>
          Выводится, если тест провалился.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><literal>E</literal></term>
      <listitem>
        <para>
          Выводится когда возникает ошибка.
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><literal>S</literal></term>
      <listitem>
        <para>
          Выводится, если тест был пропущен (см.
          <xref linkend="incomplete-and-skipped-tests" />).
        </para>
      </listitem>
    </varlistentry>

    <varlistentry>
      <term><literal>I</literal></term>
      <listitem>
        <para>
          Выводится, если тест помечен как "незавершён" или "ещё не реализован"
          (см. <xref linkend="incomplete-and-skipped-tests" />).
        </para>
      </listitem>
    </varlistentry>
  </variablelist>

  <para>
    <indexterm><primary>Ошибка (Error)</primary></indexterm>
    <indexterm><primary>Провал (Failure)</primary></indexterm>

    PHPUnit разделяет статусы <emphasis>провал</emphasis> и
    <emphasis>ошибка</emphasis>. Провал выводится в случае, если утверждение не
    выполняется <literal>assertEquals()</literal>. Ошибкой может являться
    непойманное исключение или ошибка PHP. Иногда это разграничение становится
    полезным, потому что, обычно, ошибки проще исправить чем провалы. Если в
    проекте выявлен большой список проблем - следует сперва обратить внимание на
    ошибки, и, затем, проверить оставшиеся провалы.
  </para>

  <section id="textui.clioptions">
    <title>Параметры инструмента командной строки</title>
  
    <para>
      Давайте посмотрим на список параметров в следующем коде:
    </para>

    <screen><userinput>phpunit --help</userinput>
<![CDATA[PHPUnit 3.7.0 by Sebastian Bergmann.

Usage: phpunit [switches] UnitTest [UnitTest.php]
phpunit [switches] <directory>

--log-junit <file> Log test execution in JUnit XML format to file.
--log-tap <file> Log test execution in TAP format to file.
--log-json <file> Log test execution in JSON format.

--coverage-clover <file> Generate code coverage report in Clover XML format.
--coverage-html <dir> Generate code coverage report in HTML format.
--coverage-php <file> Serialize PHP_CodeCoverage object to file.
--coverage-text=<file> Generate code coverage report in text format.
Default to writing to the standard output.

--testdox-html <file> Write agile documentation in HTML format to file.
--testdox-text <file> Write agile documentation in Text format to file.

--filter <pattern> Filter which tests to run.
--group ... Only runs tests from the specified group(s).
--exclude-group ... Exclude tests from the specified group(s).
--list-groups List available test groups.

--loader <loader> TestSuiteLoader implementation to use.
--printer <printer> TestSuiteListener implementation to use.
--repeat <times> Runs the test(s) repeatedly.

--tap Report test execution progress in TAP format.
--testdox Report test execution progress in TestDox format.

--colors Use colors in output.
--stderr Write to STDERR instead of STDOUT.
--stop-on-error Stop execution upon first error.
--stop-on-failure Stop execution upon first error or failure.
--stop-on-skipped Stop execution upon first skipped test.
--stop-on-incomplete Stop execution upon first incomplete test.
--strict Run tests in strict mode.
-v|--verbose Output more verbose information.
--debug Display debbuging information during test execution.

--process-isolation Run each test in a separate PHP process.
--no-globals-backup Do not backup and restore $GLOBALS for each test.
--static-backup Backup and restore static attributes for each test.

--bootstrap <file> A "bootstrap" PHP file that is run before the tests.
-c|--configuration <file> Read configuration from XML file.
--no-configuration Ignore default configuration file (phpunit.xml).
--include-path <path(s)> Prepend PHP's include_path with given path(s).
-d key[=value] Sets a php.ini value.

-h|--help Prints this usage information.
--version Prints the version and exits.

--debug Output debugging information.]]></screen>

    <variablelist>
      <varlistentry>
        <term><literal>phpunit UnitTest</literal></term>
        <listitem>
          <para>
            Выполняет тесты, представленные в классе <literal>UnitTest</literal>.
            Предполагается что этот класс объявлен в файле
            <filename>UnitTest.php</filename>.
          </para>

          <para>
            Класс <literal>UnitTest</literal> должен наследовать
            <literal>PHPUnit_Framework_TestCase</literal> или предоставлять
            метод <literal>public static suite()</literal>, который возвращает
            объект типа <literal>PHPUnit_Framework_Test</literal>. Например,
            экземпляр класса <literal>PHPUnit_Framework_TestSuite</literal>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>phpunit UnitTest UnitTest.php</literal></term>
        <listitem>
          <para>
            Выполняет тесты из класса <literal>UnitTest</literal>. Этот класс
            должен быть объявлен в указанном файле.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Logfile</primary></indexterm>
        <term><literal>--log-junit</literal></term>
        <listitem>
          <para>
            Генерирует файл логов в формате JUnit XML для всех пройденных тестов.
            Более детальную информацию см. <xref linkend="logging" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Logfile</primary></indexterm>
        <term><literal>--log-tap</literal></term>
        <listitem>
          <para>
            Генерирует файл логов, используя формат <ulink url="http://testanything.org/">Test Anything Protocol (TAP)</ulink>
            для пройденных тестов. Более детальную информацию см. <xref linkend="logging" />
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>JSON</primary></indexterm>
        <term><literal>--log-json</literal></term>
        <listitem>
          <para>
            Генерирует файл логов, используя
            <ulink url="http://www.json.org/">JSON</ulink> формат.
            Более детальную информацию см. <xref linkend="logging" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Покрытие кода</primary></indexterm>
        <indexterm><primary>Отчёт</primary></indexterm>
        <term><literal>--coverage-html</literal></term>
        <listitem>
          <para>
            Генерирует отчёт о покрытии кода в формате HTML.
            Более детальную информацию см.
            <xref linkend="code-coverage-analysis" />.
          </para>
          <para>
            Обратите внимание, что эта функциональность доступна, если
            установлены расширения tokenizer и Xdebug.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Покрытие кода</primary></indexterm>
        <term><literal>--coverage-clover</literal></term>
        <listitem>
          <para>
            Генерирует файл логов в формате XML для пройденых тестов.
            Более детальную информацию см. <xref linkend="logging" />.
          </para>
          <para>
            Обратите внимание, что эта функциональность доступна, если
            установлены расширения tokenizer и Xdebug.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Покрытие кода</primary></indexterm>
        <term><literal>--coverage-php</literal></term>
        <listitem>
          <para>
            Генерирует сериализованый (serialized) объект класса
            PHP_CodeCoverage с информацией о покрытии.
          </para>
          <para>
            Обратите внимание, что эта функциональность доступна, если
            установлены расширения tokenizer и Xdebug.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Покрытие кода</primary></indexterm>
        <term><literal>--coverage-text</literal></term>
        <listitem>
          <para>
            Генерирует файл логов или вывод в командной строке в человеко-читаемом
            формате.
            Более детальную информацию см. <xref linkend="logging" />.
          </para>
          <para>
            Обратите внимание, что эта функциональность доступна, если
            установлены расширения tokenizer и Xdebug.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Документация Agile</primary></indexterm>
        <term><literal>--testdox-html</literal> и <literal>--testdox-text</literal></term>
        <listitem>
          <para>
            Генерирует agile документацию в текстовом или HTML формате
            для всех запущеных тестов. Более детальную информацию см. <xref linkend="other-uses-for-tests" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--filter</literal></term>
        <listitem>
          <para>
            Вызывает только те тесты, которые содержат в себе заданный фильтр.
            Фильтром может быть название (или подстрока) теста, или же
            <ulink url="http://ru.php.net/pcre">регулярное выражение</ulink>,
            которое соответствует нескольким названиям тестов.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Группы тестов</primary></indexterm>
        <indexterm><primary>Аннотации</primary></indexterm>
        <indexterm><primary>@author</primary></indexterm>
        <indexterm><primary>@group</primary></indexterm>
        <term><literal>--group</literal></term>
        <listitem>
          <para>
            Выполняет только тесты из указанных групп. Тест может принадлежать
            группе, если он помечен аннотацией <literal>@group</literal>.
          </para>
          <para>
            Аннотация <literal>@author</literal> является синонимом аннотации
            <literal>@group</literal> и позволяет фильтровать тесты по
            их авторам.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Группы тестов</primary></indexterm>
        <indexterm><primary>Аннотации</primary></indexterm>
        <indexterm><primary>@group</primary></indexterm>
        <term><literal>--exclude-group</literal></term>
        <listitem>
          <para>
            Исключает тесты указанных групп. Тест может принадлежать
            группе, если он помечен аннотацией <literal>@group</literal>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Группы тестов</primary></indexterm>
        <indexterm><primary>Аннотации</primary></indexterm>
        <indexterm><primary>@group</primary></indexterm>
        <term><literal>--list-groups</literal></term>
        <listitem>
          <para>
            Выводит список возможных групп тестов.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>PHPUnit_Runner_TestSuiteLoader</primary></indexterm>
        <term><literal>--loader</literal></term>
        <listitem>
          <para>
            Указывает какую реализацию загрузчика <literal>PHPUnit_Runner_TestSuiteLoader</literal>
            использовать.
          </para>

          <para>
            Стандартная реализация загрузчика будет искать исходные файлы тестов
            в текущей директории и всех директориях указанных в директиве
            <literal>include_path</literal>. Названия классов должны следовать
            конвенции PEAR Naming Conventions. Например, класс
            <literal>Project_Package_Class</literal> должен быть реализован в
            файле <filename>Project/Package/Class.php</filename>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>PHPUnit_Framework_TestListener</primary></indexterm>
        <indexterm><primary>PHPUnit_Util_Printer</primary></indexterm>
        <term><literal>--printer</literal></term>
        <listitem>
          <para>
            Указывает какую реализацию форматирования вывода использовать. Этот
            класс должен наследовать <literal>PHPUnit_Util_Printer</literal> и
            реализовывать интерфейс <literal>PHPUnit_Framework_TestListener</literal>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--repeat</literal></term>
        <listitem>
          <para>
            Уазывает сколько раз прогнать тесты по кругу.
            <!-- Repeatedly runs the test(s) the specified number of times. -->
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--tap</literal></term>
        <listitem>
          <para>
            Выводит отчет в формате <ulink url="http://testanything.org/">Test Anything Protocol (TAP)</ulink>.
            Более детальную информацию см. <xref linkend="logging" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Agile Documentation</primary></indexterm>
        <term><literal>--testdox</literal></term>
        <listitem>
          <para>
            Выводит результат тестов в виде документации agile. <!-- need to check -->
            Более детальную информацию см. <xref linkend="other-uses-for-tests" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--colors</literal></term>
        <listitem>
          <para>
            Использовать цвета при выводе.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--stderr</literal></term>
        <listitem>
          <para>
            Выводить в <literal>STDERR</literal> вместо <literal>STDOUT</literal>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--stop-on-error</literal></term>
        <listitem>
          <para>
            Остановить выполнение при возникновении первой ошибки.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--stop-on-failure</literal></term>
        <listitem>
          <para>
            Остановить выполенеие при возникновении первой ошибки или провала.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--stop-on-skipped</literal></term>
        <listitem>
          <para>
            Остановить выполенеие при первом пропущеном тесте.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--stop-on-incomplete</literal></term>
        <listitem>
          <para>
            Остановить выполенеие при первом незавершенном тесте.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--strict</literal></term>
        <listitem>
          <para>
            Выполнять тесты в строгом (strict) режиме.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--verbose</literal></term>
        <listitem>
          <para>
            Выводить дополнительную информацию. Например, названия тестов,
            которые были пропущены или не завершены.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Изоляция процесса</primary></indexterm>
        <indexterm><primary>Изоляция теста</primary></indexterm>
        <term><literal>--process-isolation</literal></term>
        <listitem>
          <para>
            Выполнять каждый тест в отдельном потоке PHP.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Изоляция теста</primary></indexterm>
        <term><literal>--no-globals-backup</literal></term>
        <listitem>
          <para>
            Не сохранять и восстанавливать $GLOBALS. Более детальную информацию
            см. <xref linkend="fixtures.global-state" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Изоляция теста</primary></indexterm>
        <term><literal>--static-backup</literal></term>
        <listitem>
          <para>
            Сохранять и восстанавливать статические аттрибуты тестируемых классов.
            Более детальную информацию см. <xref linkend="fixtures.global-state" />.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--bootstrap</literal></term>
        <listitem>
          <para>
            "Bootstrap" - PHP файл, который будет запущен перед запуском тестов.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Настройки</primary></indexterm>
        <term><literal>--configuration</literal></term>
        <term><literal>-c</literal></term>
        <listitem>
          <para>
            Прочитать настройки из файла в формате XML.
            Более детальную информацию см. <xref linkend="appendixes.configuration" />.
          </para>
          <para>
            Если файл <filename>phpunit.xml</filename> или
            <filename>phpunit.xml.dist</filename> существует (в этом порядке)
            в текущей директории и опция <literal>--configuration</literal>
            <emphasis>не</emphasis> использована - файл настроек автоматически
            будет прочитан.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary>Настройки</primary></indexterm>
        <term><literal>--no-configuration</literal></term>
        <listitem>
          <para>
            Игнорировать файл <filename>phpunit.xml</filename> и
            <filename>phpunit.xml.dist</filename>, находящиеся в текущей папке.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <indexterm><primary><literal>include_path</literal></primary></indexterm>
        <term><literal>--include-path</literal></term>
        <listitem>
          <para>
            Добавить указанный(е) пути в начало директивы PHP <literal>include_path</literal>.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>-d</literal></term>
        <listitem>
          <para>
            Устанавливает заданный(е) параметр(ы) конфигурации PHP.
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><literal>--debug</literal></term>
        <listitem>
          <para>
            Выводить отладочную информацию, такую как название теста, перед
            тем как он будет запущен.
          </para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
</chapter>
